<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Control de Transacciones</title>
</head>
<body>
	<header>
		<nav>
			<ul>
				<li><a href="../index.html">Home</a></li>
				<li><a href="agregar.html">Agregar Datos</a></li>
				<li><a href="eliminar.html">Eliminar Datos</a></li>
				<li><a href="actualizar.html">Actualizar Datos</a></li>
			</ul>
		</nav>
		<hr>
		<h1>Control de Transacciones y Aislamiento</h1>
		<hr>
	</header>

	<div>
		<h2>Nivel de aislamiento</h2>
		<select id="isolationLevel">
			<option value="READ UNCOMMITTED">READ UNCOMMITTED</option>
			<option value="READ COMMITTED">READ COMMITTED</option>
			<option value="REPEATABLE READ">REPEATABLE READ</option>
			<option value="SERIALIZABLE">SERIALIZABLE</option>
		</select>
		<button onclick="setIsolation()">Cambiar nivel</button>
		<button onclick="getIsolation()">Consultar nivel actual</button>

		<h3>Resultado nivel actual:</h3>
		<p id="currentLevel">---</p>

		<hr>
		<h2>Datos en la base</h2>
		<button onclick="loadData()">Mostrar datos</button>
		<table border="1" id="dataTable">
			<thead></thead>
			<tbody></tbody>
		</table>
	</div>

	<script>
		function setIsolation() {
			const level = document.getElementById("isolationLevel").value;
			fetch("/isolation", {
				method: "POST",
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify({ level })
			})
			.then(res => res.json())
			.then(data => alert(data.message || data.error))
			.catch(err => console.error(err));
		}

		function getIsolation() {
			fetch("/isolation")
				.then(res => res.json())
				.then(data => {
					document.getElementById("currentLevel").textContent =
						data.isolation_level || "No disponible";
				})
				.catch(err => console.error(err));
		}

		function loadData() {
			fetch("/data")
				.then(res => res.json())
				.then(rows => {
					const tableHead = document.querySelector("datos");
					const tableBody = document.querySelector("id,");

					// Limpiar tabla
					tableHead.innerHTML = "";
					tableBody.innerHTML = "";

					if (rows.length > 0) {
						// Encabezados
						const headers = Object.keys(rows[0]);
						const headRow = document.createElement("tr");
						headers.forEach(h => {
							const th = document.createElement("th");
							th.textContent = h;
							headRow.appendChild(th);
						});
						tableHead.appendChild(headRow);

						// Filas
						rows.forEach(row => {
							const tr = document.createElement("tr");
							headers.forEach(h => {
								const td = document.createElement("td");
								td.textContent = row[h];
								tr.appendChild(td);
							});
							tableBody.appendChild(tr);
						});
					} else {
						const tr = document.createElement("tr");
						const td = document.createElement("td");
						td.colSpan = 100;
						td.textContent = "No hay datos";
						tr.appendChild(td);
						tableBody.appendChild(tr);
					}
				})
				.catch(err => console.error(err));
		}
	</script>
</body>
</html>
